{% extends "layout_compose.html" %}

{% block source %}
{% endblock %}

{% block body %}
<div class="ui fixed transparent main inverted menu">
    <a class="item"  href = "{{ url_for('main.index') }}">
        <i class=" green home icon"></i>BEAR.TODAY 0.1
    </a>
    <!--<a class="item"  href = "{{ url_for('main.about') }}">
        <i class="teal book icon"></i>关于
    </a>-->
    <!--<div class="ui dropdown item">
        <i class="red dashboard icon"></i>
        功能<i class="dropdown icon"></i>
        <div class="menu">
            {% if current_user.is_authenticated() %}
            {% if current_user.is_god() %}
            <a class="item"><i class="ordered list icon"></i>TODO LIST</a>
            <a class="active item" href = "{{ url_for('main.compose') }}"><i class="edit icon"></i>写作</a>
            {% endif %}
            {% endif %}
        </div>
    </div>-->
    <div class="ui icon item">
        <div class="ui tiny button" id="undo"><i class="undo icon"></i></div>
        <div class="ui tiny button" id="redo"><i class="repeat icon"></i></div>
        <div class="ui tiny button" id="dobold"><i class="bold icon"></i></div>
        <!--<div class="ui tiny button"><i class="align center icon"></i></div>
        <div class="ui tiny button"><i class="align left icon"></i></div>
        <div class="ui tiny button"><i class="align right icon"></i></div>-->
        <div class="ui tiny button" id="addurl"><i class="url icon"></i></div>
        <div class="ui tiny button" id="addimg"><i class="photo icon"></i></div>
        <!--<div class="ui tiny button"><i class="code icon"></i></div>-->
    </div>
    
    <div class="ui icon item">
        <div class="ui tiny button" id="newdoc"><i class="file outline icon"></i></div>
        <!--<div class="ui tiny button"><i class="save icon"></i></div>
        <div class="ui tiny button"><i class="open folder outline icon"></i></div>-->
        <div class="ui tiny dropdown button">
            <i class="share icon"></i>
            <div class="menu">
                <div class="item" id="exporthtml">export as HTML</div>
                <div class="item" id="exportmd">export as MD</div>
            </div>
        </div>
        <!--<div class="ui tiny button"><i class="setting icon"></i></div>-->
        <div class="ui tiny button " id="help" data-content="enjoy :)" data-position="bottom center"><i class="help icon"></i></div>
    </div>
    
    <div class="item">
        <div class="ui left small icon input">
            <input type="text" placeholder="标题(永久链接)" id="title">
            <i class="edit icon"></i>
        </div>
    </div>
    <div class="item">
        <div class="ui tiny positive button" id="submit">发布</div>
        <div class="ui tiny red button"  id="close">关闭</div>
    </div>
    <div class="right menu">
        <!--<div class="ui dropdown item">
        语言 <i class="dropdown icon"></i>
            <div class="menu">
                <a class="item">英文</a>
                <a class="item">中文</a>
            </div>
        </div>-->
        <a class="popup icon github item" data-content="View project on Github" href="https://github.com/useyourfeelings/beartoday">
            <i class="icon github"></i>
        </a>
        <div class="ui dropdown item">
            <i class="user icon"></i>
            <div class="menu">
                {% if current_user.is_authenticated() %}
                <a class="item">设置</a>
                <a class="item" href = "{{ url_for('main.user', name = current_user.name )}}">我的帐号</a>
                <a class="item" href = "{{ url_for('auth.logout') }}">退出</a>
                {% else %}
                <a class="item" href = "{{ url_for('auth.login') }}">登录</a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
    <!--<div class="ui fluid left icon input">
        <input type="text" placeholder="标题" id="title">
        <i class="edit icon"></i>
    </div>-->

    <!--<div class="ui horizontal icon divider"><i class="circular comment outline icon"></i></div>-->

<div id = "markdown_main">
    <div id="markdown_editor">##USE YOUR FEELINGS 0.1

-----------------------

> ####**HUGE thanks to the following projects:**

* [**`nginx`**](http://nginx.org)
* [**`uwsgi`**](https://github.com/unbit/uwsgi)
* [**`flask`**](http://flask.pocoo.org) and it's nice extensions
* [**`jquery`**](http://jquery.com)
* [**`semantic-ui`**](http://semantic-ui.com)
* [**`ace`**](http://ace.c9.io) need a better docucment : (
* [**`pagedown`**](https://code.google.com/p/pagedown)
* [**`highlight.js`**](http://highlightjs.org)

> ####**and all projects i missed here : ) and of course, YOU !**

----------------------

* Homepage : [**`BEAR.TODAY`**](http://bear.today)
* Location : **`Shanghai China`**
* Email : **`raidercodebear@gmail.com`**

----------------------
    </div>
    <div id = "markdown_preview">
    </div>
</div>

{% endblock %}

{% block script %}

<style type="text/css" media="screen">
    #markdown_editor { 
        position: absolute;
        top: 0px;
        right: 0;
        bottom: 0;
        left: 0;
        overflow-y:hidden;
    }
    #markdown_main { 
        position: absolute;
        top: 42px;
        right: 0;
        bottom: 0;
        left: 0;
        height:100% - 42px;
        overflow: hidden;
    }
</style>
<script type="text/javascript" src="{{ url_for('static', filename = 'js/beartoday_editor.js') }}"></script>
<script>
    function getAllMethods(object) {
        return Object.getOwnPropertyNames(object).filter(function(property) {
            return true;//typeof object[property] == 'function';
        });
    }
    
    $('#markdown_main').split({orientation:'vertical', limit:300, onDragEnd:onSplitterDargEnd});
    
    //semantic-ui
    $('.ui.dropdown').dropdown();
    $('#help').popup();
    function savepostover(data, status)
    {
        if(status == 'success' && data == "OK")
        {
            alert("发布成功");
            window.close();
        }
        else
        {
            alert("发布失败");
        }
    }

    $('#submit').bind('click', function(){
        if($('#title').val() == ""){
            alert("title is missing!");
            return;
        }
        
        $.post("savepost", {title:$('#title').val(), body:previewHtml, parent_post_id:0, ancestor_post_id:0, is_comment:0}, savepostover);
    });

    $('#close').bind('click', function(){
        window.close();
    });
</script>

{% endblock %}